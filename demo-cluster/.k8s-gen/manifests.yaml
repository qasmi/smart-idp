---
# Source: gitops-chart/templates/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: argocd
---
# Source: gitops-chart/templates/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: kagent
---
# Source: gitops-chart/templates/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: kmcp-system
---
# Source: gitops-chart/templates/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: kyverno
---
# Source: gitops-chart/templates/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: ollama-apps
---
# Source: gitops-chart/templates/project.yaml
apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: platform
  namespace: argocd
spec:
  description: Project platform
  destinations:
    - server: https://kubernetes.default.svc
      namespace: argocd
    - server: https://kubernetes.default.svc
      namespace: kagent
    - server: https://kubernetes.default.svc
      namespace: kmcp-system
    - server: https://kubernetes.default.svc
      namespace: ollama-apps
  sourceRepos:
    - https://github.com/qasmi/smart-idp.git
    - ghcr.io/kagent-dev/kagent/helm
    - ghcr.io/kagent-dev/kmcp/helm
  clusterResourceWhitelist:
    - group: rbac.authorization.k8s.io
      kind: ClusterRoleBinding
    - group: rbac.authorization.k8s.io
      kind: ClusterRole
    - group: apiextensions.k8s.io
      kind: CustomResourceDefinition
    - group: admissionregistration.k8s.io
      kind: ValidatingWebhookConfiguration
    - group: admissionregistration.k8s.io
      kind: MutatingWebhookConfiguration
    - group: apiregistration.k8s.io
      kind: APIService
    - group: scheduling.k8s.io
      kind: PriorityClass
---
# Source: gitops-chart/templates/project.yaml
apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: security
  namespace: argocd
spec:
  description: Project security
  destinations:
    - server: https://kubernetes.default.svc
      namespace: kyverno
  sourceRepos:
    - https://github.com/qasmi/smart-idp.git
  clusterResourceWhitelist:
    - group: rbac.authorization.k8s.io
      kind: ClusterRoleBinding
    - group: rbac.authorization.k8s.io
      kind: ClusterRole
    - group: apiextensions.k8s.io
      kind: CustomResourceDefinition
    - group: admissionregistration.k8s.io
      kind: ValidatingWebhookConfiguration
    - group: admissionregistration.k8s.io
      kind: MutatingWebhookConfiguration
    - group: apiregistration.k8s.io
      kind: APIService
---
# Source: gitops-chart/templates/applicationSet.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  annotations: {}
  name: platform-apps
  namespace: argocd
spec:
  goTemplate: true
  generators:
    - git:
        repoURL: https://github.com/qasmi/smart-idp.git
        revision: HEAD
        files:
          - path: "demo-cluster/team-platform/apps.yaml"
  template:
    metadata:
      name: '{{ .name }}'
      namespace: argocd
      annotations:
        argocd.argoproj.io/sync-wave: '{{ .syncWave | default "10" }}'
      finalizers:
        - "resources-finalizer.argocd.argoproj.io"
    spec:
      project: '{{ .project }}'
      revisionHistoryLimit: 3
      sources:
      - repoURL: https://github.com/qasmi/smart-idp.git
        targetRevision: HEAD
        ref: valuesRef
      destination:
        server: https://kubernetes.default.svc
        namespace: '{{ .namespace }}'
  templatePatch: |
    spec:
      sources:
        - chart: '{{ .chart }}'
          repoURL: '{{ .repo }}'
          targetRevision: '{{ .version }}'
          helm:
            valueFiles:
            {{- range .valueFiles }}
              - $valuesRef/demo-cluster/team-platform/values/{{ . }}
            {{- end }}
        - repoURL: 'https://github.com/qasmi/smart-idp.git'
          targetRevision: 'HEAD'
          path: demo-cluster/team-platform/values
          ref: valuesRef
    {{- if .autoSync }}
      syncPolicy:
        automated:
          prune: {{ .autoSync.enabled }}
          selfHeal: {{ .autoSync.enabled }}
        {{- if .autoSync.syncOptions }}
        syncOptions:
        {{- range .autoSync.syncOptions }}
          - {{ . }}
        {{- end }}
        {{- end }}
    {{- end }}
    {{- if .ignoreDifferences }}
      ignoreDifferences:
    {{- range .ignoreDifferences }}
      - group: {{ .group }}
        kind: {{ .kind }}
        {{- if .name }}
        name: {{ .name }}
        {{- end }}
        {{- if .namespace }}
        namespace: {{ .namespace }}
        {{- end }}
        {{- if .jsonPointers }}
        jsonPointers:
        {{- range .jsonPointers }}
          - {{ . }}
        {{- end }}
        {{- end }}
        {{- if .jqPathExpressions }}
        jqPathExpressions:
        {{- range .jqPathExpressions }}
          - {{ . }}
        {{- end }}
        {{- end }}
    {{- end }}
    {{- end }}
